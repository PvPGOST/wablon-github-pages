<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Telegram API</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .test-section {
            background-color: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
        }
        button {
            background-color: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #cc0000;
        }
        .log {
            background-color: #0a0a0a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç Telegram Mini App API</h1>
    
    <div class="test-section">
        <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ WebApp</h3>
        <div id="webAppInfo"></div>
    </div>
    
    <div class="test-section">
        <h3>üéØ –¢–µ—Å—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
        <button onclick="testSendData()">–¢–µ—Å—Ç sendData</button>
        <button onclick="testShowPopup()">–¢–µ—Å—Ç showPopup</button>
        <button onclick="testClose()">–¢–µ—Å—Ç close</button>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div class="test-section">
        <h3>üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
        <div id="log" class="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function checkTelegramAPI() {
            const info = document.getElementById('webAppInfo');
            
            log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram API...');
            
            if (typeof window.Telegram === 'undefined') {
                info.innerHTML = '‚ùå window.Telegram –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
                log('‚ùå window.Telegram –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return false;
            }
            
            if (typeof window.Telegram.WebApp === 'undefined') {
                info.innerHTML = '‚ùå window.Telegram.WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
                log('‚ùå window.Telegram.WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                return false;
            }
            
            const tg = window.Telegram.WebApp;
            
            info.innerHTML = `
                ‚úÖ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω<br>
                üì± Platform: ${tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                üé® Theme: ${tg.colorScheme || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                üîó Start Param: ${tg.initDataUnsafe?.start_parameter || '–ù–µ—Ç'}<br>
                üë§ User ID: ${tg.initDataUnsafe?.user?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}<br>
                üìç Version: ${tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
            `;
            
            log('‚úÖ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω');
            log(`üì± Platform: ${tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
            log(`üé® Theme: ${tg.colorScheme || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`);
            
            return true;
        }

        function testSendData() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º sendData...');
            
            const testData = {
                videoPath: "video_templates/template_test.mp4",
                displayName: "–¢–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω",
                timestamp: Date.now()
            };
            
            try {
                const jsonData = JSON.stringify(testData);
                log(`üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ: ${jsonData}`);
                
                window.Telegram.WebApp.sendData(jsonData);
                log('‚úÖ sendData –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                log('üìù –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...');
                window.Telegram.WebApp.showAlert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±–æ—Ç–∞.');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ sendData: ${error.message}`);
            }
        }

        function testShowPopup() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º showPopup...');
            
            try {
                window.Telegram.WebApp.showPopup({
                    title: "–¢–µ—Å—Ç",
                    message: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
                    buttons: [{type: "ok"}]
                });
                log('‚úÖ showPopup –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ showPopup: ${error.message}`);
            }
        }

        function testClose() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º close...');
            
            try {
                setTimeout(() => {
                    window.Telegram.WebApp.close();
                    log('‚úÖ close –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                }, 2000);
                log('‚è±Ô∏è Mini App –∑–∞–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ close: ${error.message}`);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', function() {
            log('üé¨ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
                log('üì± Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            }
            
            checkTelegramAPI();
        });
    </script>
</body>
</html>